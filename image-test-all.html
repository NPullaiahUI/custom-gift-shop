<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Test - All Products</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .test-section { margin: 30px 0; padding: 20px; border: 2px solid #ddd; border-radius: 10px; }
        .product-test { margin: 20px 0; }
        .image-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .status { padding: 5px 10px; border-radius: 5px; font-weight: bold; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="text-center mb-5">üñºÔ∏è Image Test - All Products</h1>
        
        <div class="test-section">
            <h2>üìä Test Results</h2>
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>üñºÔ∏è Product Images Test</h2>
            <div id="product-images-test" class="image-grid"></div>
        </div>
        
        <div class="test-section">
            <h2>üîó Quick Links</h2>
            <div class="row">
                <div class="col-md-4 mb-3">
                    <a href="product-detail.html?id=1" class="btn btn-primary w-100">Product Detail - ID 1</a>
                </div>
                <div class="col-md-4 mb-3">
                    <a href="products.html" class="btn btn-success w-100">All Products Page</a>
                </div>
                <div class="col-md-4 mb-3">
                    <a href="category-personalized-mugs.html" class="btn btn-info w-100">Mugs Category</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            warnings: 0
        };

        async function runImageTests() {
            console.log('üöÄ Starting image tests...');
            
            try {
                // Test API
                const response = await fetch('php/api.php?action=get-products');
                const data = await response.json();
                
                if (data.success) {
                    testResults.total = data.data.length;
                    console.log(`üìä Testing ${testResults.total} products...`);
                    
                    // Test each product
                    for (let product of data.data) {
                        await testProductImages(product);
                    }
                    
                    displayTestResults();
                } else {
                    showError('Failed to load products from API');
                }
                
            } catch (error) {
                console.error('‚ùå Test error:', error);
                showError('Test failed: ' + error.message);
            }
        }

        async function testProductImages(product) {
            console.log(`üîç Testing product: ${product.name}`);
            
            const productDiv = document.createElement('div');
            productDiv.className = 'product-test';
            productDiv.innerHTML = `
                <h4>${product.name}</h4>
                <div class="row">
                    <div class="col-md-6">
                        <h6>Main Image:</h6>
                        <img id="main-${product.id}" src="${product.image_url}" alt="${product.name}" 
                             style="width: 200px; height: 200px; object-fit: cover; border: 2px solid #ddd;">
                    </div>
                    <div class="col-md-6">
                        <h6>Gallery Images:</h6>
                        <div id="gallery-${product.id}"></div>
                    </div>
                </div>
                <div class="mt-2">
                    <span id="status-${product.id}" class="status">Testing...</span>
                </div>
            `;
            
            document.getElementById('product-images-test').appendChild(productDiv);
            
            // Test main image
            const mainImg = document.getElementById(`main-${product.id}`);
            const statusSpan = document.getElementById(`status-${product.id}`);
            
            mainImg.onload = () => {
                console.log(`‚úÖ Main image loaded for ${product.name}`);
                testResults.passed++;
            };
            
            mainImg.onerror = () => {
                console.error(`‚ùå Main image failed for ${product.name}`);
                testResults.failed++;
                statusSpan.textContent = 'Main Image Failed';
                statusSpan.className = 'status error';
            };
            
            // Test gallery images
            if (product.images) {
                try {
                    const images = JSON.parse(product.images);
                    const galleryDiv = document.getElementById(`gallery-${product.id}`);
                    
                    images.forEach((imageUrl, index) => {
                        const img = document.createElement('img');
                        img.src = imageUrl;
                        img.alt = `${product.name} - Image ${index + 1}`;
                        img.style.cssText = 'width: 80px; height: 80px; object-fit: cover; margin: 5px; border: 1px solid #ddd;';
                        img.onload = () => console.log(`‚úÖ Gallery image ${index + 1} loaded for ${product.name}`);
                        img.onerror = () => {
                            console.error(`‚ùå Gallery image ${index + 1} failed for ${product.name}`);
                            testResults.warnings++;
                        };
                        galleryDiv.appendChild(img);
                    });
                    
                    if (images.length > 0) {
                        statusSpan.textContent = `${images.length} Gallery Images`;
                        statusSpan.className = 'status success';
                    }
                } catch (e) {
                    console.error(`‚ùå Error parsing images for ${product.name}:`, e);
                    testResults.warnings++;
                    statusSpan.textContent = 'Gallery Parse Error';
                    statusSpan.className = 'status warning';
                }
            } else {
                testResults.warnings++;
                statusSpan.textContent = 'No Gallery Images';
                statusSpan.className = 'status warning';
            }
        }

        function displayTestResults() {
            const resultsDiv = document.getElementById('test-results');
            const successRate = ((testResults.passed / testResults.total) * 100).toFixed(1);
            
            resultsDiv.innerHTML = `
                <div class="row">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Total Products</h5>
                                <h3 class="text-primary">${testResults.total}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Images Loaded</h5>
                                <h3 class="text-success">${testResults.passed}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Failed</h5>
                                <h3 class="text-danger">${testResults.failed}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Success Rate</h5>
                                <h3 class="text-info">${successRate}%</h3>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-3">
                    <div class="alert ${testResults.failed === 0 ? 'alert-success' : 'alert-warning'}">
                        <strong>Test Summary:</strong> 
                        ${testResults.passed} images loaded successfully, 
                        ${testResults.failed} failed, 
                        ${testResults.warnings} warnings.
                        ${testResults.failed === 0 ? 'All images are working correctly!' : 'Some images need attention.'}
                    </div>
                </div>
            `;
        }

        function showError(message) {
            document.getElementById('test-results').innerHTML = `
                <div class="alert alert-danger">
                    <strong>Error:</strong> ${message}
                </div>
            `;
        }

        // Run tests on page load
        window.addEventListener('load', runImageTests);
    </script>
</body>
</html>
